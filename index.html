<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - Google Sheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .status-btn { transition: all 0.2s; }
        .status-btn:hover { transform: scale(1.05); }
        .status-present { background: #10b981; color: white; }
        .status-absent { background: #ef4444; color: white; }
        .status-business { background: #f59e0b; color: white; }
        .status-sick { background: #8b5cf6; color: white; }
        .status-late { background: #f97316; color: white; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .setup-highlight {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            border: 2px dashed #f59e0b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p class="text-gray-600 text-center">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
            
            <!-- Connection Status -->
            <div class="mt-4 text-center">
                <div id="connection-status" class="inline-flex items-center px-4 py-2 rounded-lg">
                    <div id="status-indicator" class="w-3 h-3 rounded-full mr-2"></div>
                    <span id="status-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</span>
                </div>
            </div>
            
            <!-- Setup Instructions -->
            <div id="setup-instructions" class="mt-6 p-6 setup-highlight rounded-lg">
                <h3 class="text-lg font-bold text-amber-800 mb-4">üîß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</h3>
                <div class="space-y-3 text-sm text-amber-700">
                    <div class="flex items-start space-x-2">
                        <span class="bg-amber-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">1</span>
                        <div>
                            <strong>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets:</strong>
                            <p>‡πÑ‡∏õ <a href="https://sheets.google.com" target="_blank" class="text-blue-600 underline">sheets.google.com</a> ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2">
                        <span class="bg-amber-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">2</span>
                        <div>
                            <strong>‡∏™‡∏£‡πâ‡∏≤‡∏á 4 ‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô:</strong>
                            <p>Classes, Subjects, Students, Attendance</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2">
                        <span class="bg-amber-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">3</span>
                        <div>
                            <strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apps Script:</strong>
                            <p>Extensions ‚Üí Apps Script ‚Üí ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ ‚Üí Deploy</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2">
                        <span class="bg-amber-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">4</span>
                        <div>
                            <strong>‡πÉ‡∏™‡πà URL:</strong>
                            <p>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Web App URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                        </div>
                    </div>
                </div>
                <button onclick="showSetupDetails()" class="mt-4 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg text-sm">
                    ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>
            
            <!-- Google Sheets Configuration -->
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="text-lg font-semibold text-blue-800 mb-4">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-blue-700 mb-2">Google Apps Script Web App URL:</label>
                        <input type="url" id="sheets-url" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" 
                               class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <p class="text-xs text-blue-600 mt-1">‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Apps Script Deploy</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="testConnection()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                            ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                        <button onclick="saveConfiguration()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                        <button onclick="initializeSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm">
                            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="flex border-b">
                <button onclick="showTab('attendance')" id="tab-attendance" class="flex-1 py-4 px-6 text-center font-medium border-b-2 border-blue-500 text-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button onclick="showTab('manage')" id="tab-manage" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button onclick="showTab('history')" id="tab-history" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button onclick="showTab('setup')" id="tab-setup" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div id="attendance-tab" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="class-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <select id="subject-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="attendance-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                <button onclick="loadAttendance()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            </div>

            <div id="attendance-grid" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div id="student-list" class="space-y-3"></div>
                <button onclick="saveAttendance()" class="mt-6 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>

        <!-- Manage Tab -->
        <div id="manage-tab" class="tab-content hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Class Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div class="mb-4">
                        <input type="text" id="new-class" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                        <button onclick="addClass()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    </div>
                    <div id="class-list" class="space-y-2"></div>
                </div>

                <!-- Subject Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div class="mb-4">
                        <input type="text" id="new-subject" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                        <button onclick="addSubject()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤</button>
                    </div>
                    <div id="subject-list" class="space-y-2"></div>
                </div>
            </div>

            <!-- Student Management -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="student-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" id="student-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <select id="student-class" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                </div>
                <button onclick="addStudent()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <div id="student-management-list" class="space-y-2"></div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="grid md:grid-cols-4 gap-4 mb-4">
                    <select id="history-class" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                    <select id="history-subject" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    </select>
                    <input type="date" id="history-start-date" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="date" id="history-end-date" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button onclick="searchHistory()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>

            <div id="history-results" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
                <div id="history-table" class="overflow-x-auto"></div>
            </div>
        </div>

        <!-- Setup Tab -->
        <div id="setup-tab" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Step 1: Create Google Sheets -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</span>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets
                    </h2>
                    <div class="space-y-4">
                        <p>1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://sheets.google.com" target="_blank" class="text-blue-600 underline">sheets.google.com</a></p>
                        <p>2. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡πÄ‡∏õ‡∏£‡∏î‡∏ä‡∏µ‡∏ï‡πÉ‡∏´‡∏°‡πà"</p>
                        <p>3. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤ "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"</p>
                        <p>4. ‡∏™‡∏£‡πâ‡∏≤‡∏á 4 ‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô (Sheet) ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:</p>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="font-semibold">‡πÅ‡∏ú‡πà‡∏ô "Classes":</h4>
                                    <pre class="text-xs bg-white p-2 rounded mt-1">A1: ClassName
A2: ‡∏°.1/1
A3: ‡∏°.1/2
A4: ‡∏°.2/1</pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold">‡πÅ‡∏ú‡πà‡∏ô "Subjects":</h4>
                                    <pre class="text-xs bg-white p-2 rounded mt-1">A1: SubjectName
A2: ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
A3: ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
A4: ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold">‡πÅ‡∏ú‡πà‡∏ô "Students":</h4>
                                    <pre class="text-xs bg-white p-2 rounded mt-1">A1: StudentID | B1: Name | C1: Class
A2: 001 | B2: ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à | C2: ‡∏°.1/1
A3: 002 | B3: ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ | C3: ‡∏°.1/1</pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold">‡πÅ‡∏ú‡πà‡∏ô "Attendance":</h4>
                                    <pre class="text-xs bg-white p-2 rounded mt-1">A1: Date | B1: Class | C1: Subject | D1: StudentID | E1: Status
(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Apps Script -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</span>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apps Script
                    </h2>
                    <div class="space-y-4">
                        <p>1. ‡πÉ‡∏ô Google Sheets ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <strong>Extensions ‚Üí Apps Script</strong></p>
                        <p>2. ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ:</p>
                        <div class="bg-gray-900 text-green-400 p-4 rounded-lg text-xs overflow-x-auto">
                            <button onclick="copyAppsScriptCode()" class="float-right bg-blue-600 text-white px-2 py-1 rounded text-xs mb-2">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                            <pre id="apps-script-code">function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheet = SpreadsheetApp.getActiveSpreadsheet();
    
    switch(data.action) {
      case 'getClasses':
        return getClasses(sheet);
      case 'getSubjects':
        return getSubjects(sheet);
      case 'getStudents':
        return getStudents(sheet, data.className);
      case 'saveAttendance':
        return saveAttendance(sheet, data);
      case 'getAttendance':
        return getAttendance(sheet, data);
      case 'addClass':
        return addClass(sheet, data.className);
      case 'addSubject':
        return addSubject(sheet, data.subjectName);
      case 'addStudent':
        return addStudent(sheet, data);
      case 'initializeData':
        return initializeData(sheet);
      case 'testConnection':
        return testConnection();
      default:
        return createResponse({success: false, message: 'Unknown action'});
    }
  } catch (error) {
    return createResponse({success: false, message: error.toString()});
  }
}

function doGet(e) {
  return testConnection();
}

function createResponse(data) {
  return ContentService
    .createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}

function testConnection() {
  return createResponse({
    success: true, 
    message: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
    timestamp: new Date().toISOString()
  });
}

function getClasses(sheet) {
  const classSheet = sheet.getSheetByName('Classes');
  if (!classSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Classes'});
  }
  
  const data = classSheet.getRange('A2:A').getValues();
  const classes = data.filter(row => row[0] !== '').map(row => row[0]);
  
  return createResponse({success: true, data: classes});
}

function getSubjects(sheet) {
  const subjectSheet = sheet.getSheetByName('Subjects');
  if (!subjectSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Subjects'});
  }
  
  const data = subjectSheet.getRange('A2:A').getValues();
  const subjects = data.filter(row => row[0] !== '').map(row => row[0]);
  
  return createResponse({success: true, data: subjects});
}

function getStudents(sheet, className) {
  const studentSheet = sheet.getSheetByName('Students');
  if (!studentSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Students'});
  }
  
  const data = studentSheet.getRange('A2:C').getValues();
  const students = data
    .filter(row => row[0] !== '' && row[2] === className)
    .map(row => ({id: row[0], name: row[1], class: row[2]}));
  
  return createResponse({success: true, data: students});
}

function saveAttendance(sheet, data) {
  const attendanceSheet = sheet.getSheetByName('Attendance');
  if (!attendanceSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Attendance'});
  }
  
  // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
  const existingData = attendanceSheet.getRange('A2:E').getValues();
  const rowsToDelete = [];
  
  for (let i = 0; i < existingData.length; i++) {
    if (existingData[i][0] === data.date && 
        existingData[i][1] === data.className && 
        existingData[i][2] === data.subject) {
      rowsToDelete.push(i + 2); // +2 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß 2
    }
  }
  
  // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô
  for (let i = rowsToDelete.length - 1; i >= 0; i--) {
    attendanceSheet.deleteRow(rowsToDelete[i]);
  }
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
  const newData = [];
  Object.keys(data.attendance).forEach(studentId => {
    newData.push([
      data.date,
      data.className,
      data.subject,
      studentId,
      data.attendance[studentId]
    ]);
  });
  
  if (newData.length > 0) {
    const lastRow = attendanceSheet.getLastRow();
    attendanceSheet.getRange(lastRow + 1, 1, newData.length, 5).setValues(newData);
  }
  
  return createResponse({success: true, message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});
}

function getAttendance(sheet, data) {
  const attendanceSheet = sheet.getSheetByName('Attendance');
  if (!attendanceSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Attendance'});
  }
  
  const allData = attendanceSheet.getRange('A2:E').getValues();
  const filteredData = allData.filter(row => 
    row[0] === data.date && 
    row[1] === data.className && 
    row[2] === data.subject
  );
  
  const attendance = {};
  filteredData.forEach(row => {
    attendance[row[3]] = row[4]; // studentId: status
  });
  
  return createResponse({success: true, data: attendance});
}

function addClass(sheet, className) {
  const classSheet = sheet.getSheetByName('Classes');
  if (!classSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Classes'});
  }
  
  const lastRow = classSheet.getLastRow();
  classSheet.getRange(lastRow + 1, 1).setValue(className);
  
  return createResponse({success: true, message: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});
}

function addSubject(sheet, subjectName) {
  const subjectSheet = sheet.getSheetByName('Subjects');
  if (!subjectSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Subjects'});
  }
  
  const lastRow = subjectSheet.getLastRow();
  subjectSheet.getRange(lastRow + 1, 1).setValue(subjectName);
  
  return createResponse({success: true, message: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});
}

function addStudent(sheet, studentData) {
  const studentSheet = sheet.getSheetByName('Students');
  if (!studentSheet) {
    return createResponse({success: false, message: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô Students'});
  }
  
  const lastRow = studentSheet.getLastRow();
  studentSheet.getRange(lastRow + 1, 1, 1, 3).setValues([[
    studentData.id,
    studentData.name,
    studentData.class
  ]]);
  
  return createResponse({success: true, message: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});
}

function initializeData(sheet) {
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
  const sheets = ['Classes', 'Subjects', 'Students', 'Attendance'];
  
  sheets.forEach(sheetName => {
    let targetSheet = sheet.getSheetByName(sheetName);
    if (!targetSheet) {
      targetSheet = sheet.insertSheet(sheetName);
    }
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    switch(sheetName) {
      case 'Classes':
        targetSheet.getRange('A1').setValue('ClassName');
        if (targetSheet.getLastRow() === 1) {
          targetSheet.getRange('A2:A5').setValues([['‡∏°.1/1'], ['‡∏°.1/2'], ['‡∏°.2/1'], ['‡∏°.2/2']]);
        }
        break;
      case 'Subjects':
        targetSheet.getRange('A1').setValue('SubjectName');
        if (targetSheet.getLastRow() === 1) {
          targetSheet.getRange('A2:A5').setValues([['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'], ['‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢'], ['‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'], ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå']]);
        }
        break;
      case 'Students':
        targetSheet.getRange('A1:C1').setValues([['StudentID', 'Name', 'Class']]);
        if (targetSheet.getLastRow() === 1) {
          targetSheet.getRange('A2:C6').setValues([
            ['001', '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ', '‡∏°.1/1'],
            ['002', '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏î‡∏µ‡πÉ‡∏à', '‡∏°.1/1'],
            ['003', '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏°.1/2'],
            ['004', '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ', '‡∏°.2/1'],
            ['005', '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏õ‡∏≠‡∏á ‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏°.2/2']
          ]);
        }
        break;
      case 'Attendance':
        targetSheet.getRange('A1:E1').setValues([['Date', 'Class', 'Subject', 'StudentID', 'Status']]);
        break;
    }
  });
  
  return createResponse({success: true, message: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});
}</pre>
                        </div>
                        <p>3. ‡∏Ñ‡∏•‡∏¥‡∏Å <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</strong> (Ctrl+S)</p>
                        <p>4. ‡∏Ñ‡∏•‡∏¥‡∏Å <strong>Deploy ‚Üí New deployment</strong></p>
                        <p>5. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Type: <strong>Web app</strong></p>
                        <p>6. Execute as: <strong>Me</strong></p>
                        <p>7. Who has access: <strong>Anyone</strong></p>
                        <p>8. ‡∏Ñ‡∏•‡∏¥‡∏Å <strong>Deploy</strong></p>
                        <p>9. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å <strong>Web app URL</strong> ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</p>
                    </div>
                </div>

                <!-- Step 3: Configure System -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">3</span>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                    </h2>
                    <div class="space-y-4">
                        <p>1. ‡∏ô‡∏≥ Web app URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á "Google Apps Script Web App URL" ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
                        <p>2. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                        <p>3. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p>
                        <p>4. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö URL</p>
                        <p>5. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-red-600">üîß ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢</h2>
                    <div class="space-y-3 text-sm">
                        <div class="p-3 bg-red-50 rounded-lg">
                            <strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> "Script function not found"<br>
                            <strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î Apps Script ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß
                        </div>
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> "Permission denied"<br>
                            <strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ "Who has access" ‡πÄ‡∏õ‡πá‡∏ô "Anyone" ‡πÉ‡∏ô Deploy settings
                        </div>
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï<br>
                            <strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà Google Sheets ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div class="fixed bottom-4 right-4 space-y-2">
            <div id="sync-status" class="bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hidden">
                <span id="sync-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        let SHEETS_URL = localStorage.getItem('sheets_url') || '';
        let isConnected = false;

        // Data cache
        let appData = {
            classes: [],
            subjects: [],
            students: [],
            attendance: {}
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendance-date').value = today;
            document.getElementById('history-start-date').value = today;
            document.getElementById('history-end-date').value = today;
            
            // Load saved configuration
            if (SHEETS_URL) {
                document.getElementById('sheets-url').value = SHEETS_URL;
                testConnection();
            } else {
                updateConnectionStatus('offline', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets');
            }
        });

        // Connection management
        function updateConnectionStatus(status, message) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            const container = document.getElementById('connection-status');
            
            switch (status) {
                case 'connecting':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-yellow-500 pulse';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-yellow-100 text-yellow-800';
                    break;
                case 'online':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-green-500';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-green-100 text-green-800';
                    isConnected = true;
                    document.getElementById('setup-instructions').style.display = 'none';
                    break;
                case 'offline':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-red-500';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-red-100 text-red-800';
                    isConnected = false;
                    break;
            }
            
            text.textContent = message;
        }

        async function testConnection() {
            const url = document.getElementById('sheets-url').value.trim();
            if (!url) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL');
                return;
            }

            updateConnectionStatus('connecting', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
            showSyncStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets...');

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors'
                });

                const result = await response.json();
                
                if (result.success) {
                    updateConnectionStatus('online', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    showSyncStatus('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    SHEETS_URL = url;
                    
                    // Load initial data
                    await loadAllData();
                } else {
                    throw new Error(result.message || '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            } catch (error) {
                console.error('Connection test failed:', error);
                updateConnectionStatus('offline', '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message);
                showSyncStatus('‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 3000);
        }

        function saveConfiguration() {
            const url = document.getElementById('sheets-url').value.trim();
            if (!url) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL');
                return;
            }

            localStorage.setItem('sheets_url', url);
            SHEETS_URL = url;
            
            showSyncStatus('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
            setTimeout(hideSyncStatus, 2000);
        }

        async function initializeSheets() {
            if (!SHEETS_URL) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            showSyncStatus('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets...');

            try {
                const response = await callSheetsAPI('initializeData', {});
                
                if (response.success) {
                    showSyncStatus('‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    await loadAllData();
                } else {
                    throw new Error(response.message);
                }
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 3000);
        }

        // API calls
        async function callSheetsAPI(action, data) {
            if (!SHEETS_URL) {
                throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets URL');
            }

            const payload = {
                action: action,
                ...data
            };

            const response = await fetch(SHEETS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        // Data loading
        async function loadAllData() {
            if (!isConnected) return;

            try {
                showSyncStatus('üì• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...');

                // Load classes
                const classesResponse = await callSheetsAPI('getClasses', {});
                if (classesResponse.success) {
                    appData.classes = classesResponse.data;
                }

                // Load subjects
                const subjectsResponse = await callSheetsAPI('getSubjects', {});
                if (subjectsResponse.success) {
                    appData.subjects = subjectsResponse.data;
                }

                refreshAllSelects();
                showSyncStatus('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                
            } catch (error) {
                console.error('Error loading data:', error);
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 2000);
        }

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('text-gray-500');
            });
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            
            const activeBtn = document.getElementById(`tab-${tabName}`);
            activeBtn.classList.add('border-blue-500', 'text-blue-600');
            activeBtn.classList.remove('text-gray-500');
            
            if (tabName === 'manage') {
                refreshManagementLists();
            } else if (tabName === 'history') {
                refreshHistorySelects();
            }
        }

        // Class management
        async function addClass() {
            const className = document.getElementById('new-class').value.trim();
            if (!className) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');
                return;
            }

            if (!isConnected) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets');
                return;
            }

            try {
                showSyncStatus('‚ûï ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...');
                
                const response = await callSheetsAPI('addClass', { className: className });
                
                if (response.success) {
                    appData.classes.push(className);
                    document.getElementById('new-class').value = '';
                    refreshAllSelects();
                    showSyncStatus(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${className}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                } else {
                    throw new Error(response.message);
                }
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 2000);
        }

        // Subject management
        async function addSubject() {
            const subjectName = document.getElementById('new-subject').value.trim();
            if (!subjectName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤');
                return;
            }

            if (!isConnected) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets');
                return;
            }

            try {
                showSyncStatus('üìö ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤...');
                
                const response = await callSheetsAPI('addSubject', { subjectName: subjectName });
                
                if (response.success) {
                    appData.subjects.push(subjectName);
                    document.getElementById('new-subject').value = '';
                    refreshAllSelects();
                    showSyncStatus(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ "${subjectName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                } else {
                    throw new Error(response.message);
                }
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 2000);
        }

        // Student management
        async function addStudent() {
            const name = document.getElementById('student-name').value.trim();
            const id = document.getElementById('student-id').value.trim();
            const className = document.getElementById('student-class').value;
            
            if (!name || !id || !className) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            if (!isConnected) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets');
                return;
            }

            try {
                showSyncStatus('üë®‚Äçüéì ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...');
                
                const response = await callSheetsAPI('addStudent', {
                    id: id,
                    name: name,
                    class: className
                });
                
                if (response.success) {
                    appData.students.push({ id, name, class: className });
                    document.getElementById('student-name').value = '';
                    document.getElementById('student-id').value = '';
                    document.getElementById('student-class').value = '';
                    refreshManagementLists();
                    showSyncStatus(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                } else {
                    throw new Error(response.message);
                }
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 2000);
        }

        // Attendance management
        async function loadAttendance() {
            const className = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const date = document.getElementById('attendance-date').value;
            
            if (!className || !subject || !date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }

            if (!isConnected) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets');
                return;
            }

            try {
                showSyncStatus('üì• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...');

                // Load students
                const studentsResponse = await callSheetsAPI('getStudents', { className: className });
                if (!studentsResponse.success) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ');
                }

                const students = studentsResponse.data;
                
                // Load existing attendance
                const attendanceResponse = await callSheetsAPI('getAttendance', {
                    date: date,
                    className: className,
                    subject: subject
                });

                const existingAttendance = attendanceResponse.success ? attendanceResponse.data : {};
                
                // Display students
                const studentListEl = document.getElementById('student-list');
                studentListEl.innerHTML = '';
                
                students.forEach(student => {
                    const studentDiv = document.createElement('div');
                    studentDiv.className = 'flex items-center justify-between p-4 border border-gray-200 rounded-lg';
                    studentDiv.innerHTML = `
                        <div>
                            <span class="font-medium">${student.name}</span>
                            <span class="text-gray-500 ml-2">(${student.id})</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="setAttendanceStatus('${student.id}', 'present')" 
                                    class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'present' ? 'status-present' : 'bg-gray-200 text-gray-700'}">
                                ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (/)
                            </button>
                            <button onclick="setAttendanceStatus('${student.id}', 'absent')" 
                                    class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'absent' ? 'status-absent' : 'bg-gray-200 text-gray-700'}">
                                ‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Ç)
                            </button>
                            <button onclick="setAttendanceStatus('${student.id}', 'business')" 
                                    class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'business' ? 'status-business' : 'bg-gray-200 text-gray-700'}">
                                ‡∏•‡∏≤‡∏Å‡∏¥‡∏à (‡∏•)
                            </button>
                            <button onclick="setAttendanceStatus('${student.id}', 'sick')" 
                                    class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'sick' ? 'status-sick' : 'bg-gray-200 text-gray-700'}">
                                ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢ (‡∏õ)
                            </button>
                            <button onclick="setAttendanceStatus('${student.id}', 'late')" 
                                    class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'late' ? 'status-late' : 'bg-gray-200 text-gray-700'}">
                                ‡∏™‡∏≤‡∏¢ (‡∏™)
                            </button>
                        </div>
                    `;
                    studentListEl.appendChild(studentDiv);
                });
                
                // Store current attendance data
                appData.currentAttendance = existingAttendance;
                
                document.getElementById('attendance-grid').classList.remove('hidden');
                showSyncStatus('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 2000);
        }

        function setAttendanceStatus(studentId, status) {
            if (!appData.currentAttendance) {
                appData.currentAttendance = {};
            }
            
            appData.currentAttendance[studentId] = status;
            
            // Update button styles
            const studentDiv = event.target.closest('.flex.items-center');
            const buttons = studentDiv.querySelectorAll('.status-btn');
            buttons.forEach(btn => {
                btn.className = 'status-btn px-3 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700';
            });
            
            event.target.className = `status-btn px-3 py-2 rounded-lg text-sm font-medium status-${status}`;
        }

        async function saveAttendance() {
            const className = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const date = document.getElementById('attendance-date').value;
            
            if (!className || !subject || !date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }

            if (!isConnected) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets');
                return;
            }

            if (!appData.currentAttendance || Object.keys(appData.currentAttendance).length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                return;
            }

            try {
                showSyncStatus('üíæ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...');
                
                const response = await callSheetsAPI('saveAttendance', {
                    date: date,
                    className: className,
                    subject: subject,
                    attendance: appData.currentAttendance
                });
                
                if (response.success) {
                    showSyncStatus('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } else {
                    throw new Error(response.message);
                }
            } catch (error) {
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            }

            setTimeout(hideSyncStatus, 3000);
        }

        // History search (simplified for demo)
        function searchHistory() {
            showSyncStatus('üîç ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ');
            setTimeout(hideSyncStatus, 3000);
        }

        // UI refresh functions
        function refreshAllSelects() {
            refreshClassSelects();
            refreshSubjectSelects();
            refreshManagementLists();
        }

        function refreshClassSelects() {
            const selects = ['class-select', 'student-class', 'history-class'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
                appData.classes.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function refreshSubjectSelects() {
            const selects = ['subject-select', 'history-subject'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>';
                appData.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function refreshManagementLists() {
            // Class list
            const classList = document.getElementById('class-list');
            classList.innerHTML = '';
            appData.classes.forEach(className => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span>${className}</span>
                    <span class="text-sm text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets</span>
                `;
                classList.appendChild(div);
            });

            // Subject list
            const subjectList = document.getElementById('subject-list');
            subjectList.innerHTML = '';
            appData.subjects.forEach(subject => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span>${subject}</span>
                    <span class="text-sm text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets</span>
                `;
                subjectList.appendChild(div);
            });

            // Student list
            const studentList = document.getElementById('student-management-list');
            studentList.innerHTML = '';
            appData.students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <div>
                        <span class="font-medium">${student.name}</span>
                        <span class="text-gray-500 ml-2">(${student.id})</span>
                        <span class="text-blue-600 ml-2">${student.class}</span>
                    </div>
                    <span class="text-sm text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets</span>
                `;
                studentList.appendChild(div);
            });
        }

        function refreshHistorySelects() {
            refreshClassSelects();
            refreshSubjectSelects();
        }

        // Utility functions
        function showSyncStatus(message, isError = false) {
            const status = document.getElementById('sync-status');
            const messageEl = document.getElementById('sync-message');
            messageEl.textContent = message;
            status.className = `bg-${isError ? 'red' : 'gray'}-800 text-white px-4 py-2 rounded-lg shadow-lg`;
            status.classList.remove('hidden');
        }

        function hideSyncStatus() {
            document.getElementById('sync-status').classList.add('hidden');
        }

        function showSetupDetails() {
            showTab('setup');
        }

        function copyAppsScriptCode() {
            const code = document.getElementById('apps-script-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showSyncStatus('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î Apps Script ‡πÅ‡∏•‡πâ‡∏ß!');
                setTimeout(hideSyncStatus, 2000);
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c98210b340798f',t:'MTc1NDc2NjE0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
