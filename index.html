<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .status-btn { transition: all 0.2s; }
        .status-btn:hover { transform: scale(1.05); }
        .status-present { background: #10b981; color: white; }
        .status-absent { background: #ef4444; color: white; }
        .status-business { background: #f59e0b; color: white; }
        .status-sick { background: #8b5cf6; color: white; }
        .status-late { background: #f97316; color: white; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p class="text-gray-600 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
            
            <!-- Connection Status -->
            <div class="mt-4 text-center">
                <div id="connection-status" class="inline-flex items-center px-4 py-2 rounded-lg">
                    <div id="status-indicator" class="w-3 h-3 rounded-full mr-2"></div>
                    <span id="status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
                </div>
            </div>
            
            <!-- Room Code Section -->
            <div id="room-setup" class="mt-6 p-4 bg-blue-50 rounded-lg">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-semibold text-blue-800">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <p class="text-sm text-blue-600">‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</p>
                    <div id="online-users" class="mt-2 p-2 bg-blue-100 border border-blue-300 rounded text-xs text-blue-800 hidden">
                        üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: <span id="user-count">0</span> ‡∏Ñ‡∏ô
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-4 items-center justify-center">
                    <div class="flex-1 max-w-md">
                        <input type="text" id="room-code-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (6 ‡∏´‡∏•‡∏±‡∏Å)" 
                               class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center font-mono text-lg"
                               maxlength="6">
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="joinRoom()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á
                        </button>
                        <button onclick="createNewRoom()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                        </button>
                        <button onclick="testRealTime()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
                        </button>
                    </div>
                </div>
                <div id="current-room" class="mt-4 text-center hidden">
                    <div class="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-lg">
                        <span class="font-medium">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: </span>
                        <span id="current-room-code" class="font-mono text-lg ml-2"></span>
                        <button onclick="leaveRoom()" class="ml-3 text-red-600 hover:text-red-800 text-sm">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-4">
                <div class="flex space-x-2 text-sm">
                    <span class="px-3 py-1 bg-green-500 text-white rounded-full">/ = ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                    <span class="px-3 py-1 bg-red-500 text-white rounded-full">‡∏Ç = ‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                    <span class="px-3 py-1 bg-yellow-500 text-white rounded-full">‡∏• = ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</span>
                    <span class="px-3 py-1 bg-purple-500 text-white rounded-full">‡∏õ = ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</span>
                    <span class="px-3 py-1 bg-orange-500 text-white rounded-full">‡∏™ = ‡∏™‡∏≤‡∏¢</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="flex border-b">
                <button onclick="showTab('attendance')" id="tab-attendance" class="flex-1 py-4 px-6 text-center font-medium border-b-2 border-blue-500 text-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button onclick="showTab('manage')" id="tab-manage" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button onclick="showTab('history')" id="tab-history" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div id="attendance-tab" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="class-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <select id="subject-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="attendance-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                <button onclick="loadAttendance()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            </div>

            <div id="attendance-grid" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div id="student-list" class="space-y-3"></div>
                <button onclick="saveAttendance()" class="mt-6 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>

        <!-- Manage Tab -->
        <div id="manage-tab" class="tab-content hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Class Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div class="mb-4">
                        <input type="text" id="new-class" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                        <button onclick="addClass()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    </div>
                    <div id="class-list" class="space-y-2"></div>
                </div>

                <!-- Subject Management -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div class="mb-4">
                        <input type="text" id="new-subject" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                        <button onclick="addSubject()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤</button>
                    </div>
                    <div id="subject-list" class="space-y-2"></div>
                </div>
            </div>

            <!-- Student Management -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h2 class="text-xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="student-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" id="student-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <select id="student-class" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                </div>
                <button onclick="addStudent()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <div id="student-management-list" class="space-y-2"></div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="grid md:grid-cols-4 gap-4 mb-4">
                    <select id="history-class" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                    <select id="history-subject" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    </select>
                    <input type="date" id="history-start-date" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="date" id="history-end-date" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button onclick="searchHistory()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>

            <div id="history-results" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
                <div id="history-table" class="overflow-x-auto"></div>
            </div>
        </div>

        <!-- Sync Status -->
        <div class="fixed bottom-4 right-4 space-y-2">
            <div id="sync-status" class="bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hidden">
                <span id="sync-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
            </div>
            <button onclick="resetSystem()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow-lg text-sm">
                ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö
            </button>
        </div>
    </div>

    <script>
        // ‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Real-time ‡∏à‡∏≥‡∏•‡∏≠‡∏á
        let ROOM_CODE = localStorage.getItem('attendance_room_code') || null;
        let isOnline = false;
        let onlineUsers = 1;
        let syncInterval = null;
        let userId = 'user_' + Math.random().toString(36).substr(2, 9);

        // Data structure
        let appData = {
            classes: ['‡∏°.1/1', '‡∏°.1/2', '‡∏°.2/1', '‡∏°.2/2'],
            subjects: ['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
            students: [
                { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ', id: '001', class: '‡∏°.1/1' },
                { name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏î‡∏µ‡πÉ‡∏à', id: '002', class: '‡∏°.1/1' },
                { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', id: '003', class: '‡∏°.1/2' },
                { name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ', id: '004', class: '‡∏°.2/1' },
                { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏õ‡∏≠‡∏á ‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', id: '005', class: '‡∏°.2/2' }
            ],
            attendance: {}
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendance-date').value = today;
            document.getElementById('history-start-date').value = today;
            document.getElementById('history-end-date').value = today;
            
            // Initialize connection
            initializeConnection();
            
            // Load data
            loadLocalData();
            refreshAllSelects();
            
            // Show current room if exists
            if (ROOM_CODE) {
                showCurrentRoom();
                startRealTimeSync();
            }
        });

        // Connection simulation
        function initializeConnection() {
            updateConnectionStatus('connecting', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
            
            setTimeout(() => {
                isOnline = true;
                updateConnectionStatus('online', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡πâ‡∏ß');
                
                if (ROOM_CODE) {
                    startRealTimeSync();
                }
            }, 2000);
        }

        function updateConnectionStatus(status, message) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            const container = document.getElementById('connection-status');
            
            switch (status) {
                case 'connecting':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-yellow-500 pulse';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-yellow-100 text-yellow-800';
                    break;
                case 'online':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-green-500';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-green-100 text-green-800';
                    break;
                case 'offline':
                    indicator.className = 'w-3 h-3 rounded-full mr-2 bg-red-500';
                    container.className = 'inline-flex items-center px-4 py-2 rounded-lg bg-red-100 text-red-800';
                    break;
            }
            
            text.textContent = message;
        }

        // Room management
        function generateRoomCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        function createNewRoom() {
            const newRoomCode = generateRoomCode();
            ROOM_CODE = newRoomCode;
            localStorage.setItem('attendance_room_code', ROOM_CODE);
            
            showCurrentRoom();
            startRealTimeSync();
            saveData();
            
            showSyncStatus(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á: ${ROOM_CODE}`);
            setTimeout(hideSyncStatus, 3000);
        }

        function joinRoom() {
            const roomCode = document.getElementById('room-code-input').value.trim().toUpperCase();
            if (!roomCode || roomCode.length !== 6) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 6 ‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            showSyncStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...');
            
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á
            setTimeout(() => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ô localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const roomData = localStorage.getItem(`room_${roomCode}`);
                
                if (roomData) {
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                    try {
                        const parsedData = JSON.parse(roomData);
                        appData = { ...appData, ...parsedData };
                        refreshAllSelects();
                    } catch (error) {
                        console.error('Error loading room data:', error);
                    }
                }
                
                ROOM_CODE = roomCode;
                localStorage.setItem('attendance_room_code', ROOM_CODE);
                
                showCurrentRoom();
                startRealTimeSync();
                document.getElementById('room-code-input').value = '';
                
                showSyncStatus(`‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á ${roomCode} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                setTimeout(hideSyncStatus, 2000);
            }, 1000);
        }

        function showCurrentRoom() {
            if (ROOM_CODE) {
                document.getElementById('current-room-code').textContent = ROOM_CODE;
                document.getElementById('current-room').classList.remove('hidden');
                document.getElementById('online-users').classList.remove('hidden');
                updateUserCount();
            }
        }

        function leaveRoom() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                stopRealTimeSync();
                
                ROOM_CODE = null;
                localStorage.removeItem('attendance_room_code');
                
                document.getElementById('current-room').classList.add('hidden');
                document.getElementById('online-users').classList.add('hidden');
                
                showSyncStatus('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                setTimeout(hideSyncStatus, 2000);
            }
        }

        // Real-time sync with Firebase-like behavior
        let lastSyncTime = 0;
        let syncQueue = [];
        
        function startRealTimeSync() {
            if (!ROOM_CODE || syncInterval) return;
            
            showSyncStatus('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå');
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            syncInterval = setInterval(() => {
                if (ROOM_CODE) {
                    syncWithRoom();
                }
            }, 2000);
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            setTimeout(() => {
                syncWithRoom();
                hideSyncStatus();
            }, 500);
            
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            simulateOnlineUsers();
        }

        function stopRealTimeSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                showSyncStatus('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß');
                setTimeout(hideSyncStatus, 2000);
            }
        }

        function syncWithRoom() {
            if (!ROOM_CODE) return;
            
            const roomKey = `room_${ROOM_CODE}`;
            const now = Date.now();
            
            try {
                // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á
                const currentRoomData = localStorage.getItem(roomKey);
                let roomData = null;
                
                if (currentRoomData) {
                    roomData = JSON.parse(currentRoomData);
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (roomData.lastSyncTime && roomData.lastSyncTime > lastSyncTime && roomData.updatedBy !== userId) {
                        // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô
                        const { lastSyncTime: _, updatedBy: __, ...newData } = roomData;
                        
                        // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        const currentHash = JSON.stringify(appData);
                        const newHash = JSON.stringify(newData);
                        
                        if (currentHash !== newHash) {
                            appData = { ...newData };
                            refreshAllSelects();
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
                            showSyncStatus('üì• ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô!', false);
                            setTimeout(hideSyncStatus, 3000);
                            
                            lastSyncTime = roomData.lastSyncTime;
                            return; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                        }
                    }
                }
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á
                const dataToSave = {
                    ...appData,
                    lastSyncTime: now,
                    updatedBy: userId,
                    syncVersion: (roomData?.syncVersion || 0) + 1
                };
                
                localStorage.setItem(roomKey, JSON.stringify(dataToSave));
                lastSyncTime = now;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                if (syncQueue.length > 0) {
                    showSyncStatus('üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                    setTimeout(hideSyncStatus, 1500);
                    syncQueue = [];
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                showSyncStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå', true);
                setTimeout(hideSyncStatus, 3000);
            }
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏¥‡∏ß‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
        function queueSync(action) {
            syncQueue.push({
                action: action,
                timestamp: Date.now()
            });
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
            if (ROOM_CODE) {
                setTimeout(syncWithRoom, 100);
            }
        }

        function simulateOnlineUsers() {
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            setInterval(() => {
                if (ROOM_CODE) {
                    // ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 1-5 ‡∏Ñ‡∏ô
                    onlineUsers = Math.floor(Math.random() * 5) + 1;
                    updateUserCount();
                }
            }, 10000);
        }

        function updateUserCount() {
            document.getElementById('user-count').textContent = onlineUsers;
        }

        function testRealTime() {
            if (!ROOM_CODE) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
                return;
            }
            
            showSyncStatus('üß™ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå...');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
            const timestamp = new Date().toLocaleTimeString('th-TH');
            const testClass = `‡∏ó‡∏î‡∏™‡∏≠‡∏ö-${timestamp}`;
            const testSubject = `‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö-${timestamp}`;
            
            appData.classes.push(testClass);
            appData.subjects.push(testSubject);
            refreshAllSelects();
            saveData('test_add');
            
            showSyncStatus(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ${testClass}`);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            setTimeout(() => {
                showSyncStatus('üì± ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ');
            }, 2000);
            
            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                appData.classes = appData.classes.filter(c => c !== testClass);
                appData.subjects = appData.subjects.filter(s => s !== testSubject);
                refreshAllSelects();
                saveData('test_remove');
                
                showSyncStatus('üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
                setTimeout(hideSyncStatus, 3000);
            }, 8000);
        }

        // Data management
        function loadLocalData() {
            const localData = localStorage.getItem('attendance_data');
            if (localData) {
                try {
                    const parsedData = JSON.parse(localData);
                    appData = { ...appData, ...parsedData };
                } catch (error) {
                    console.error('Error parsing local data:', error);
                }
            }
        }

        function saveData(action = 'update') {
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            localStorage.setItem('attendance_data', JSON.stringify(appData));
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏¥‡∏ß‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
            queueSync(action);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            showSyncStatus('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
            setTimeout(hideSyncStatus, 1000);
        }

        function showSyncStatus(message, isError = false) {
            const status = document.getElementById('sync-status');
            const messageEl = document.getElementById('sync-message');
            messageEl.textContent = message;
            status.className = `bg-${isError ? 'red' : 'gray'}-800 text-white px-4 py-2 rounded-lg shadow-lg`;
            status.classList.remove('hidden');
        }

        function hideSyncStatus() {
            document.getElementById('sync-status').classList.add('hidden');
        }

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('text-gray-500');
            });
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            
            const activeBtn = document.getElementById(`tab-${tabName}`);
            activeBtn.classList.add('border-blue-500', 'text-blue-600');
            activeBtn.classList.remove('text-gray-500');
            
            if (tabName === 'manage') {
                refreshManagementLists();
            } else if (tabName === 'history') {
                refreshHistorySelects();
            }
        }

        // Class management
        function addClass() {
            const className = document.getElementById('new-class').value.trim();
            if (className && !appData.classes.includes(className)) {
                appData.classes.push(className);
                document.getElementById('new-class').value = '';
                refreshAllSelects();
                saveData('add_class');
                showSyncStatus(`‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${className}" ‡πÅ‡∏•‡πâ‡∏ß`);
                setTimeout(hideSyncStatus, 2000);
            }
        }

        function removeClass(className) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${className}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                appData.classes = appData.classes.filter(c => c !== className);
                appData.students = appData.students.filter(s => s.class !== className);
                refreshAllSelects();
                saveData();
                showSyncStatus(`‡∏•‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${className}" ‡πÅ‡∏•‡πâ‡∏ß`);
                setTimeout(hideSyncStatus, 2000);
            }
        }

        // Subject management
        function addSubject() {
            const subjectName = document.getElementById('new-subject').value.trim();
            if (subjectName && !appData.subjects.includes(subjectName)) {
                appData.subjects.push(subjectName);
                document.getElementById('new-subject').value = '';
                refreshAllSelects();
                saveData('add_subject');
                showSyncStatus(`üìö ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ "${subjectName}" ‡πÅ‡∏•‡πâ‡∏ß`);
                setTimeout(hideSyncStatus, 2000);
            }
        }

        function removeSubject(subjectName) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ "${subjectName}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                appData.subjects = appData.subjects.filter(s => s !== subjectName);
                refreshAllSelects();
                saveData();
                showSyncStatus(`‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ "${subjectName}" ‡πÅ‡∏•‡πâ‡∏ß`);
                setTimeout(hideSyncStatus, 2000);
            }
        }

        // Student management
        function addStudent() {
            const name = document.getElementById('student-name').value.trim();
            const id = document.getElementById('student-id').value.trim();
            const className = document.getElementById('student-class').value;
            
            if (name && id && className) {
                if (!appData.students.find(s => s.id === id)) {
                    appData.students.push({ name, id, class: className });
                    document.getElementById('student-name').value = '';
                    document.getElementById('student-id').value = '';
                    document.getElementById('student-class').value = '';
                    refreshManagementLists();
                    saveData('add_student');
                    showSyncStatus(`üë®‚Äçüéì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${name}" ‡πÅ‡∏•‡πâ‡∏ß`);
                    setTimeout(hideSyncStatus, 2000);
                } else {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
        }

        function removeStudent(studentId) {
            const student = appData.students.find(s => s.id === studentId);
            if (student && confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${student.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                appData.students = appData.students.filter(s => s.id !== studentId);
                refreshManagementLists();
                saveData();
                showSyncStatus(`‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${student.name}" ‡πÅ‡∏•‡πâ‡∏ß`);
                setTimeout(hideSyncStatus, 2000);
            }
        }

        // Attendance management
        function loadAttendance() {
            const className = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const date = document.getElementById('attendance-date').value;
            
            if (!className || !subject || !date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }
            
            const students = appData.students.filter(s => s.class === className);
            const attendanceKey = `${className}-${subject}-${date}`;
            const existingAttendance = appData.attendance[attendanceKey] || {};
            
            const studentListEl = document.getElementById('student-list');
            studentListEl.innerHTML = '';
            
            students.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'flex items-center justify-between p-4 border border-gray-200 rounded-lg';
                studentDiv.innerHTML = `
                    <div>
                        <span class="font-medium">${student.name}</span>
                        <span class="text-gray-500 ml-2">(${student.id})</span>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="setAttendanceStatus('${student.id}', 'present')" 
                                class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'present' ? 'status-present' : 'bg-gray-200 text-gray-700'}">
                            ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (/)
                        </button>
                        <button onclick="setAttendanceStatus('${student.id}', 'absent')" 
                                class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'absent' ? 'status-absent' : 'bg-gray-200 text-gray-700'}">
                            ‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Ç)
                        </button>
                        <button onclick="setAttendanceStatus('${student.id}', 'business')" 
                                class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'business' ? 'status-business' : 'bg-gray-200 text-gray-700'}">
                            ‡∏•‡∏≤‡∏Å‡∏¥‡∏à (‡∏•)
                        </button>
                        <button onclick="setAttendanceStatus('${student.id}', 'sick')" 
                                class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'sick' ? 'status-sick' : 'bg-gray-200 text-gray-700'}">
                            ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢ (‡∏õ)
                        </button>
                        <button onclick="setAttendanceStatus('${student.id}', 'late')" 
                                class="status-btn px-3 py-2 rounded-lg text-sm font-medium ${existingAttendance[student.id] === 'late' ? 'status-late' : 'bg-gray-200 text-gray-700'}">
                            ‡∏™‡∏≤‡∏¢ (‡∏™)
                        </button>
                    </div>
                `;
                studentListEl.appendChild(studentDiv);
            });
            
            document.getElementById('attendance-grid').classList.remove('hidden');
        }

        function setAttendanceStatus(studentId, status) {
            const className = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const date = document.getElementById('attendance-date').value;
            const attendanceKey = `${className}-${subject}-${date}`;
            
            if (!appData.attendance[attendanceKey]) {
                appData.attendance[attendanceKey] = {};
            }
            
            appData.attendance[attendanceKey][studentId] = status;
            
            // Update button styles
            const studentDiv = event.target.closest('.flex.items-center');
            const buttons = studentDiv.querySelectorAll('.status-btn');
            buttons.forEach(btn => {
                btn.className = 'status-btn px-3 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700';
            });
            
            event.target.className = `status-btn px-3 py-2 rounded-lg text-sm font-medium status-${status}`;
            
            // Auto save with sync
            saveData('attendance_update');
        }

        function saveAttendance() {
            saveData('attendance_save');
            showSyncStatus('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            setTimeout(hideSyncStatus, 2000);
        }

        // History search
        function searchHistory() {
            const className = document.getElementById('history-class').value;
            const subject = document.getElementById('history-subject').value;
            const startDate = document.getElementById('history-start-date').value;
            const endDate = document.getElementById('history-end-date').value;
            
            if (!className || !subject || !startDate || !endDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const students = appData.students.filter(s => s.class === className);
            
            // Generate date range
            const start = new Date(startDate);
            const end = new Date(endDate);
            const dates = [];
            
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                dates.push(new Date(d).toISOString().split('T')[0]);
            }
            
            // Build results table
            let tableHTML = `
                <table class="min-w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™</th>
            `;
            
            dates.forEach(date => {
                const dateObj = new Date(date);
                const shortDate = `${dateObj.getDate()}/${dateObj.getMonth() + 1}`;
                tableHTML += `<th class="border border-gray-300 px-2 py-2 text-center text-xs">${shortDate}</th>`;
            });
            
            tableHTML += `
                            <th class="border border-gray-300 px-4 py-2 text-center">‡∏™‡∏£‡∏∏‡∏õ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            students.forEach(student => {
                let presentCount = 0, absentCount = 0, businessCount = 0, sickCount = 0, lateCount = 0;
                
                tableHTML += `
                    <tr>
                        <td class="border border-gray-300 px-4 py-2">${student.name}</td>
                        <td class="border border-gray-300 px-4 py-2">${student.id}</td>
                `;
                
                dates.forEach(date => {
                    const attendanceKey = `${className}-${subject}-${date}`;
                    const status = appData.attendance[attendanceKey]?.[student.id] || '';
                    
                    let displayStatus = '';
                    let cellClass = 'border border-gray-300 px-2 py-2 text-center text-sm';
                    
                    switch (status) {
                        case 'present':
                            displayStatus = '/';
                            cellClass += ' bg-green-100 text-green-800';
                            presentCount++;
                            break;
                        case 'absent':
                            displayStatus = '‡∏Ç';
                            cellClass += ' bg-red-100 text-red-800';
                            absentCount++;
                            break;
                        case 'business':
                            displayStatus = '‡∏•';
                            cellClass += ' bg-yellow-100 text-yellow-800';
                            businessCount++;
                            break;
                        case 'sick':
                            displayStatus = '‡∏õ';
                            cellClass += ' bg-purple-100 text-purple-800';
                            sickCount++;
                            break;
                        case 'late':
                            displayStatus = '‡∏™';
                            cellClass += ' bg-orange-100 text-orange-800';
                            lateCount++;
                            break;
                        default:
                            cellClass += ' bg-gray-50';
                    }
                    
                    tableHTML += `<td class="${cellClass}">${displayStatus}</td>`;
                });
                
                tableHTML += `
                    <td class="border border-gray-300 px-4 py-2 text-sm">
                        <div class="text-xs space-y-1">
                            <div>‡∏°‡∏≤: ${presentCount}</div>
                            <div>‡∏Ç‡∏≤‡∏î: ${absentCount}</div>
                            <div>‡∏•‡∏≤‡∏Å‡∏¥‡∏à: ${businessCount}</div>
                            <div>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢: ${sickCount}</div>
                            <div>‡∏™‡∏≤‡∏¢: ${lateCount}</div>
                        </div>
                    </td>
                </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            
            document.getElementById('history-table').innerHTML = tableHTML;
            document.getElementById('history-results').classList.remove('hidden');
        }

        // UI refresh functions
        function refreshAllSelects() {
            refreshClassSelects();
            refreshSubjectSelects();
            refreshManagementLists();
            refreshHistorySelects();
        }

        function refreshClassSelects() {
            const selects = ['class-select', 'student-class', 'history-class'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
                appData.classes.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function refreshSubjectSelects() {
            const selects = ['subject-select', 'history-subject'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>';
                appData.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function refreshManagementLists() {
            // Class list
            const classList = document.getElementById('class-list');
            classList.innerHTML = '';
            appData.classes.forEach(className => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span>${className}</span>
                    <button onclick="removeClass('${className}')" class="text-red-600 hover:text-red-800 text-sm">‡∏•‡∏ö</button>
                `;
                classList.appendChild(div);
            });

            // Subject list
            const subjectList = document.getElementById('subject-list');
            subjectList.innerHTML = '';
            appData.subjects.forEach(subject => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span>${subject}</span>
                    <button onclick="removeSubject('${subject}')" class="text-red-600 hover:text-red-800 text-sm">‡∏•‡∏ö</button>
                `;
                subjectList.appendChild(div);
            });

            // Student list
            const studentList = document.getElementById('student-management-list');
            studentList.innerHTML = '';
            appData.students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <div>
                        <span class="font-medium">${student.name}</span>
                        <span class="text-gray-500 ml-2">(${student.id})</span>
                        <span class="text-blue-600 ml-2">${student.class}</span>
                    </div>
                    <button onclick="removeStudent('${student.id}')" class="text-red-600 hover:text-red-800 text-sm">‡∏•‡∏ö</button>
                `;
                studentList.appendChild(div);
            });
        }

        function refreshHistorySelects() {
            refreshClassSelects();
            refreshSubjectSelects();
        }

        // System reset
        function resetSystem() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                stopRealTimeSync();
                
                // Clear all localStorage
                localStorage.removeItem('attendance_data');
                localStorage.removeItem('attendance_room_code');
                
                // Clear room data
                if (ROOM_CODE) {
                    localStorage.removeItem(`room_${ROOM_CODE}`);
                }
                
                // Reset data
                appData = {
                    classes: ['‡∏°.1/1', '‡∏°.1/2', '‡∏°.2/1', '‡∏°.2/2'],
                    subjects: ['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                    students: [
                        { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ', id: '001', class: '‡∏°.1/1' },
                        { name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏î‡∏µ‡πÉ‡∏à', id: '002', class: '‡∏°.1/1' },
                        { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', id: '003', class: '‡∏°.1/2' },
                        { name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ', id: '004', class: '‡∏°.2/1' },
                        { name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏õ‡∏≠‡∏á ‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', id: '005', class: '‡∏°.2/2' }
                    ],
                    attendance: {}
                };
                
                ROOM_CODE = null;
                
                // Hide room display
                document.getElementById('current-room').classList.add('hidden');
                document.getElementById('online-users').classList.add('hidden');
                
                // Refresh UI
                refreshAllSelects();
                document.getElementById('attendance-grid').classList.add('hidden');
                document.getElementById('history-results').classList.add('hidden');
                
                showSyncStatus('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                setTimeout(hideSyncStatus, 2000);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c96f0ee70e7991',t:'MTc1NDc2NTM3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
